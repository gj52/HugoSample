{{ define "main" }}
<header>
    <h1><span class="dn di-l">{{ site.Title | markdownify }}</span><i class="ph3 fas fa-dragon fa-fw"></i>{{ .Page.Title | markdownify }}</h1>
    {{ partial "single-head" . }}
</header>
<article>
    {{ with .Content}}{{ . }}{{end}} {{ $ms := site.Params.Images.maxSize | default 1480}}
    <div class=gallery>
    {{range .Resources.Match "gallery/*" -}}{{$alt := .Name}}{{$image := .}}{{ $preview := .Fit "480x320 jpg #ffffff q75" }}{{ $background := .Fit "33x22 jpg #ffffff q50" }} {{ $title := "preview"}}

{{ $iw := $image.Width }}{{ $ih := $image.Height }}
{{ if or (ge $iw $ms) (ge $ih $ms) }}{{ $image = $image.Fit (print $ms "x" $ms ) }}{{end}}

{{ $srcset := slice }}{{ range site.Params.Images.setSizes -}}
    {{ if lt (mul . 1.2) $iw }}{{ $size := print  . "x" .}}
    {{ $thumb := $image.Fit $size }}
    {{ $srcset = $srcset | append (printf ("%s %dw") $thumb.RelPermalink $thumb.Width ) }}
    {{ end }}
{{- end }}

  <a data-fancybox="gallery" data-src={{$image.RelPermalink}} 
    {{ if gt (len $srcset) 0 }}
      data-sizes="(max-width: 480px) 90vw, (max-width: 960px) 80vw, {{ $image.Width }}px" 
      {{ $sl := delimit $srcset ", "}}data-srcset="{{$sl}}" 
    {{ end }}
    data-type=image data-height={{ $image.Height }} data-width={{ $image.Width}}>

    <img loading=lazy class=foto src={{ $preview.RelPermalink }}  alt="{{ $alt }}" title="{{$title}}"
      width={{ $preview.Width }} height={{ $preview.Height }}
      style="background: url(data:image/jpeg;base64,{{ $background.Content | base64Encode  }}); 
      background-size:100% 100%;" />
  </a>
{{- end }}
</div>

<script importance=low>
$('[data-fancybox="gallery"]').fancybox({

  lang: "de",

   Toolbar: {
    display: [
      { id: "prev", position: "center" },
      { id: "counter", position: "center" },
      { id: "next", position: "center" },
      "slideshow",
      "fullscreen",
      "thumbs",
      "close",
    ],
  },
  
  animated: true,
  dragToClose: false,

  showClass: false,
  hideClass: false,

  closeButton: "top",

  Image: {
    zoom: false,
    click: false,
    wheel: "slide"
  },

  Thumbs: {
    autoStart: false,
  },

});
</script>
{{ partial "prevnext" .}}   
</article>
{{ end }}
